{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var r=Object.create;var c=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var l=a=>c(a,\"__esModule\",{value:!0});var u=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=>{l(a);for(var t in s)c(a,t,{get:s[t],enumerable:!0})},k=(a,s,t)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!m.call(a,n)&&n!==\"default\"&&c(a,n,{get:()=>s[n],enumerable:!(t=d(s,n))||t.enumerable});return a},g=a=>k(l(c(a!=null?r(p(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=u((x,i)=>{i.exports=_jsx_runtime});var y={};N(y,{default:()=>w,frontmatter:()=>b});var e=g(o()),b={title:\"Object Detection from Scratch - Part 1\",date:new Date(1673537534e3),lastmod:\"2023-01-29\",tags:[\"object detection\",\"code\"],draft:!1};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(t,{})})):t();function t(){let n=Object.assign({p:\"p\",a:\"a\",pre:\"pre\",code:\"code\",span:\"span\",h2:\"h2\",img:\"img\",h3:\"h3\",em:\"em\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(\"img\",{src:\"https://www.storminthecastle.com/img/01_classification_files/computervision1_256.jpeg\"}),(0,e.jsx)(\"br\",{}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://github.com/johnrobinsn/ObjectDetectionNotebooks/blob/main/nbs/01_classification.ipynb\",children:(0,e.jsx)(\"img\",{src:\"https://www.storminthecastle.com/img/github.svg\"})}),(0,e.jsx)(n.a,{href:\"https://colab.research.google.com/github/johnrobinsn/ObjectDetectionNotebooks/blob/main/nbs/01_classification.ipynb\",children:(0,e.jsx)(\"img\",{src:\"https://www.storminthecastle.com/img/colab.svg\"})})]}),(0,e.jsxs)(n.p,{children:[`This is the start of my new series, \"Object Detection from Scratch\", which is focused on building an intuition for how single-pass object detectors such as YOLO and SSD work. Object detection considers the problem of building a model that can take an image and detect multiple objects within that image; predicting not only the object classes but also the bounding boxes of those objects within the image. Single-pass detectors such as YOLO and SSD have solved this problem end-to-end performing the object detection task in a single forward inference pass of the model. If what I'm describing is not clear, here is a fun video of `,(0,e.jsx)(n.a,{href:\"https://www.youtube.com/watch?v=MPU2HistivI\",children:\"YOLO in action\"}),\".\"]}),(0,e.jsx)(n.p,{children:\"In this series, I will incrementally build up a YOLO/SSD (Single Shot Detector) object model with just PyTorch and the current version of the FastAI 2 library. Both SSD and YOLO allow for single pass inference and can run efficiently on fairly low-end hardware allowing for realtime object detection for video content etc.\"}),(0,e.jsxs)(n.p,{children:[\"In order to learn about object detection we'll need a dataset. We'll be focused on using the \",(0,e.jsx)(n.a,{href:\"http://host.robots.ox.ac.uk/pascal/VOC/voc2007/index.html\",children:\"Pascal VOC dataset (2007)\"}),\". In total this dataset includes almost 10k images, containing about 24k annotated objects covering 20 different object classes. Each image is annotated with some number of object class labels and their cooresponding bounding boxes.\"]}),(0,e.jsx)(n.p,{children:\"The notebooks in this series are designed to be easily used within Google Colab (free) or if you have your own GPU I'd recommend using conda to setup an environment with Python >3.9 and pip install fastai.\"}),(0,e.jsx)(n.p,{children:'To easily open this notebook just click on the \"Open in Colab\" button above.'}),(0,e.jsx)(n.p,{children:\"The FastAI (FAI) library makes it easy to download the Pascal VOC dataset and access the object annotations.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" fastai\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"vision\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"all\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),`\n`]})})}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`/home/jr/anaconda3/envs/fastaip2_3/lib/python3.9/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: libtorch_cuda_cu.so: cannot open shared object file: No such file or directory\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`warn(f\"Failed to load image Python extension: {e}\")\n`})]})}),(0,e.jsx)(n.p,{children:\"Download the dataset using FAI's untar_data function and take a quick look at the files that have been downloaded.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"path \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" untar_data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"URLs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"PASCAL_2007\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"path\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"ls\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"(#8) [Path('/home/jr/.fastai/data/pascal_2007/train.json'),Path('/home/jr/.fastai/data/pascal_2007/test.csv'),Path('/home/jr/.fastai/data/pascal_2007/train.csv'),Path('/home/jr/.fastai/data/pascal_2007/train'),Path('/home/jr/.fastai/data/pascal_2007/test.json'),Path('/home/jr/.fastai/data/pascal_2007/valid.json'),Path('/home/jr/.fastai/data/pascal_2007/segmentation'),Path('/home/jr/.fastai/data/pascal_2007/test')]\"})}),(0,e.jsxs)(n.h2,{id:\"exploring-the-dataset\",children:[(0,e.jsx)(n.a,{href:\"#exploring-the-dataset\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Exploring the Dataset\"]}),(0,e.jsx)(n.p,{children:\"FAI includes a get_annotations function that can parse COCO style bounding box annotations which the VOC dataset uses. Here we'll just load the data associated with the train set (train.json). The function will return a tuple of lists. The first list will contain the image file names in the training set. The second list will contain cooresponding bounding boxes and object class labels for those images.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"imgs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"lbl_bbox \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" get_annotations\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"path\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'train.json'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"imgs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"lbl_bbox\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"(2501, 2501)\"})}),(0,e.jsx)(n.p,{children:\"The dataset provides over 2500 training labeled (classes and bounding boxes). Here is a single example that demonstrates an image that has more than one object annotated. Showing two bounding boxes in image-space coordinates along with their respective object class labels.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"imgs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"lbl_bbox\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# show a single example\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"('000017.jpg', ([[184, 61, 279, 199], [89, 77, 403, 336]], ['person', 'horse']))\"})}),(0,e.jsx)(n.p,{children:\"The bounding boxes consist of four numbers, the first two numbers represent the xy coordinates of the upper left corner of the bounding box and the second two numbers represent the xy coordinates of the lower right corner of the bounding box.\"}),(0,e.jsxs)(n.h2,{id:\"visualize-the-dataset\",children:[(0,e.jsx)(n.a,{href:\"#visualize-the-dataset\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Visualize the Dataset\"]}),(0,e.jsx)(n.p,{children:\"Using the matplotlib library let's visualize an example from the training set.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" matplotlib\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"colors \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),` mcolors\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" matplotlib\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"cm \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),` cmx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" matplotlib \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" patches\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),` patheffects\n`]})]})}),(0,e.jsx)(n.p,{children:\"Let's grab a sample out of the training set to explore.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# grab our example\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"img_file\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"img_bbox \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" imgs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"lbl_bbox\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"img_file\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`img_bbox\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"('000017.jpg', ([[184, 61, 279, 199], [89, 77, 403, 336]], ['person', 'horse']))\"})}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# load the image using PIL\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"img \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" Image\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"open\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"path\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:\"f'train/\"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"img_file\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`img\n`})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"png\",src:\"https://www.storminthecastle.com/img/01_classification_files/01_classification_14_0.png\"})}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"h\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"w \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" img\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`shape\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"h\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"w \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# the height and width of the image; Note that height is typically specified first for numpy and PIL\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"(364, 480)\"})}),(0,e.jsx)(n.p,{children:\"The images in the dataset come in different sizes and shapes (but all 3 channel RGB images). In order to be able to use a GPU to accelerate training, we will want to work with a batch of images all in one go. This means that all of our images will need to be of the same size so that we can stack a batch into a single tensor. A fairly typical size to work with is 224x224 pixels. One important consideration is that since our bounding boxes are defined in image space coordinates, we really don't want to crop the images since we might cut off our bounding boxes, therefore we opt to squish the images instead.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SIZE\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"224\"}),`\n`]})})}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# resample/rescale the example image by squishing\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"img_scaled \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" img\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"resize\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"SIZE\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"SIZE\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`img_scaled\n`})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"png\",src:\"https://www.storminthecastle.com/img/01_classification_files/01_classification_18_0.png\"})}),(0,e.jsx)(n.p,{children:\"Given the task of object detection our independent variable are the images and the dependent variables are the object classes and the object bounding boxes. Given an image, we will want our model to predict a class label for each object in the image along with a bounding box for each object. One wrinkle however is that our bounding box (dependent variable) is defined in the coordinate space of our image (independent variable). So if we scale the input image we must also be careful to scale the bounding boxes along with it. Since the image has been squished to be of size 224x224 pixels we need to squish (scale) the dimensions our bounding boxes for that sample by the same amount. Here I show the steps required to squish the dimensions of the bounding boxes for our sample.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# calculate how how much we've scaled each dimension of the image\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"yscale\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"xscale \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" h\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\"SIZE\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"w\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),`SIZE\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"yscale\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`xscale\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"(1.625, 2.142857142857143)\"})}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# apply the same scale factor to each coordinate of the bounding box\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"img_bbox_scaled \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"x1\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"//\"}),\"xscale\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"y1\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"//\"}),\"yscale\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"x2\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"//\"}),\"xscale\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"y2\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"//\"}),\"yscale\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" x1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"y1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"x2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"y2 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" img_bbox\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`img_bbox_scaled\n`})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"[[85.0, 37.0, 130.0, 122.0], [41.0, 47.0, 188.0, 206.0]]\"})}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# reconstruct the labled set of bounding boxes with the scaled bounding boxes for our example\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"img_bbox_scaled \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"img_bbox_scaled\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"img_bbox\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`img_bbox_scaled\n`})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"([[85.0, 37.0, 130.0, 122.0], [41.0, 47.0, 188.0, 206.0]], ['person', 'horse'])\"})}),(0,e.jsx)(n.p,{children:\"Here is a small utility function for displaying an image in such a way that we can layer on some additional annotations.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"show_img\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"im\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" figsize\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"None\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" ax\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"None\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" ax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" fig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"ax \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" plt\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"subplots\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"figsize\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"figsize\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    ax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"imshow\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"im\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    ax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"set_xticks\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"np\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"linspace\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"224\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    ax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"set_yticks\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"np\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"linspace\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"224\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    ax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"grid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    ax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"set_yticklabels\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    ax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"set_xticklabels\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),` ax\n`]})]})}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"show_img\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"img_scaled\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"<AxesSubplot: >\"})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"png\",src:\"https://www.storminthecastle.com/img/01_classification_files/01_classification_25_1.png\"})}),(0,e.jsx)(n.p,{children:\"We will want to be able to overlay the class labels on top of our image in the appropriate locations along with the bounding boxes for each object. Here are a couple of utility functions that allow us to draw text on top of an image and allow us to draw a rectangle on top of an image.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# draw an outline around the shape; used to add contrast to the text so we can read it easily\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"draw_outline\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" lw\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"set_path_effects\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"patheffects\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Stroke\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        linewidth\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"lw\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" foreground\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'black'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" patheffects\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Normal\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# draw text in the specified location along with an outline so that there is some contrast between the text and the image\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"draw_text\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" xy\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" txt\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" sz\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"14\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" color\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'white'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    text \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" ax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"text\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"xy\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" txt\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        verticalalignment\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'top'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" color\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"color\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" fontsize\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"sz\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" weight\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'bold'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    draw_outline\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"text\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"draw_rect\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" color\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'white'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    patch \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" ax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"add_patch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"patches\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Rectangle\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" fill\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"False\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" edgecolor\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"color\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" lw\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    draw_outline\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"patch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"get_cmap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"N\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    color_norm  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" mcolors\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Normalize\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"vmin\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" vmax\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"N\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" cmx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"ScalarMappable\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"norm\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"color_norm\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" cmap\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Set3'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`to_rgba\n`]})]})}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# generate a list of different colors for rendering our bounding boxes\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"num_colr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"12\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"cmap \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" get_cmap\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"num_colr\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"colr_list \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"cmap\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"float\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"x\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" x \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"range\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"num_colr\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# draw an image along with it's associated bounding boxes and class labels\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"show_item\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"im\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" lbl_bbox\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" figsize\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"None\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" ax\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"None\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" ax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" fig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"ax \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" plt\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"subplots\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"figsize\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"figsize\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    ax \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" show_img\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"im\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" ax\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"ax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"c\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"enumerate\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"zip\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"lbl_bbox\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" lbl_bbox\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        b \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        draw_rect\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" color\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"colr_list\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"%\"}),\"num_colr\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        draw_text\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" c\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" color\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"colr_list\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"%\"}),\"num_colr\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Let's draw our scaled image along with it's scaled bounding boxes and class labels.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"show_item\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"img_scaled\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"img_bbox_scaled\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"png\",src:\"https://www.storminthecastle.com/img/01_classification_files/01_classification_32_0.png\"})}),(0,e.jsx)(n.p,{children:\"By now you should have a pretty good understanding of what the dataset looks like. Our goal for this series of articles will be to use this dataset to develop and train an object detection model that can take an image as input and will output a list of class labels for each object within the image along with their respective bounding boxes. But we will do this incrementally in order to build up an intuition of how the system will work.\"}),(0,e.jsxs)(n.h2,{id:\"decomposing-the-problem\",children:[(0,e.jsx)(n.a,{href:\"#decomposing-the-problem\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Decomposing the problem\"]}),(0,e.jsx)(n.p,{children:\"Let's start with a easier problem and work our way up from there. Let's make a much simpler model, one that takes an image as input and predicts just a single object class for the image. let's do this for the largest object present in each image. We can use our dataset and the bounding box information that we have to identify the largest object in each image and use that as a derived dataset to get us started.\"}),(0,e.jsx)(n.p,{children:\"Here's a function that given a labeled bounding box sample will return the largest single bounding box along with it's class label.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# utility function that takes a bounding box in the form of x1,y1,x2,y2 and returns it's area (w*h)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"area\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# zip the bounding boxes together with the object class;\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# sort it descending order by the size of the bounding;\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# return the first one (largest one)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"get_largest\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"boxes\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"sorted\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"L\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"zip\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"boxes\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"key\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"lambda\"}),\" b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\"area\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Review our sample out of the dataset.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# our labled bounding box sample\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`img_bbox_scaled\n`})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"([[85.0, 37.0, 130.0, 122.0], [41.0, 47.0, 188.0, 206.0]], ['person', 'horse'])\"})}),(0,e.jsx)(n.p,{children:\"Use the get_largest function to get the largest object for a given sample.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# get the largest object from our sample\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"get_largest\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"img_bbox_scaled\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"([41.0, 47.0, 188.0, 206.0], 'horse')\"})}),(0,e.jsx)(n.p,{children:\"Now that we have a way to get the largest object for a sample we can just use a list comprehension to process all of the training metadata and produce a new training set that just contains the largest objects for each image.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"lrg_bbox \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"get_largest\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"boxes\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" boxes \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" lbl_bbox\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:\"Create a dictionary that we can use to look up we can look up our dependent variables (largest object and bounding box for each image) given the independent variable(img file name)\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"img2lrgbbox \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"dict\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"zip\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"imgs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"lrg_bbox\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# look at a sample from our dictionary\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"k \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" L\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"img2lrgbbox\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" k\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"img2lrgbbox\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"k\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"('000017.jpg', ([89, 77, 403, 336], 'horse'))\"})}),(0,e.jsxs)(n.h2,{id:\"training-a-classification-model\",children:[(0,e.jsx)(n.a,{href:\"#training-a-classification-model\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Training a Classification Model\"]}),(0,e.jsx)(n.p,{children:\"Let's setup and train a model that will classify the largest object within a given image. Fast AI makes this pretty quick and easy using the DataBlock API. For now we won't use the bounding box information but will just use the class label from the dictionary that we created.\"}),(0,e.jsxs)(n.h3,{id:\"setting-up-the-dataloaders\",children:[(0,e.jsx)(n.a,{href:\"#setting-up-the-dataloaders\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Setting up the Dataloaders\"]}),(0,e.jsx)(n.p,{children:\"Define a getter for the DataBlock API. Given a training image file name will return the full path to the image file and the class label of the largest object in that image.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# returns [full path to image file, largest object class name]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"getters \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"lambda\"}),\" o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" path\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'train'\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\"o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"lambda\"}),\" o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" img2lrgbbox\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Try out the Datablock getter providing an image file name from our dataset (k).\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"k\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"getters\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"k\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"getters\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"k\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"('000017.jpg', Path('/home/jr/.fastai/data/pascal_2007/train/000017.jpg'),'horse')\"})}),(0,e.jsx)(n.p,{children:\"A few image transforms. item_tfms will be used to make all of the dataset images the same size. batch_tfms will be used to procedurally create more training data to improve our model performance.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"item_tfms \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Resize\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"224\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" method\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'squish'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"batch_tfms \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Rotate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" Flip\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" Dihedral\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Some basic image augmentions so that that our model get's more input image diversity during training\"}),`\n`]})]})}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"dblock \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" DataBlock\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"blocks\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ImageBlock\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" CategoryBlock\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                 getters\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"getters\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                 item_tfms\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"item_tfms\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                 batch_tfms\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"batch_tfms\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"dls \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" dblock\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"dataloaders\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"imgs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" bs \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"128\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:\"Fast AI will look at the dataset and collect all of the classes that our dataset contains which yields 20 classes as follows:\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"dls\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"vocab\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"dls\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"vocab\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"(['aeroplane', 'bicycle', 'bird', 'boat', 'bottle', 'bus', 'car', 'cat', 'chair', 'cow', 'diningtable', 'dog', 'horse', 'motorbike', 'person', 'pottedplant', 'sheep', 'sofa', 'train', 'tvmonitor'], 20)\"})}),(0,e.jsx)(n.p,{children:\"Now that our data has been setup, Fast AI can show us a sample training batch that will be fed into the model for training. Showing the images and the ground truth labels for the largest object in the image.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:\"Note: Image augmentations specified above will be randomly applied.\"})}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"dls\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"show_batch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"png\",src:\"https://www.storminthecastle.com/img/01_classification_files/01_classification_57_0.png\"})}),(0,e.jsx)(n.p,{children:\"We can now use the vision_learner API and specify our dataset, the model architecture that we'd like to use, and any training metrics that we'd like to see while training.\"}),(0,e.jsx)(n.p,{children:\"Here we'll use resnet34 model which provides a pretty good mix of capacity and performance for our experiment. Here FAI uses transfer learning by default where the pretrained weights for the resnet34 model will be used.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:\"Note: These pretrained weights were trained against the imagenet dataset and will enable our model to learn much faster.\"})}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"learn \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" vision_learner\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"dls\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"resnet34\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"metrics\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"accuracy\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"/home/jr/anaconda3/envs/fastaip2_3/lib/python3.9/site-packages/torchvision/models/\\\\_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead. warnings.warn( /home/jr/anaconda3/envs/fastaip2_3/lib/python3.9/site-packages/torchvision/models/\\\\_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=ResNet34_Weights.IMAGENET1K_V1`. You can also use `weights=ResNet34_Weights.DEFAULT` to get the most up-to-date weights. warnings.warn(msg)\"})}),(0,e.jsx)(n.p,{children:\"Fast AI auto selects a suitable loss function for a classification model given that we specified the CategoryBlock via the DataBlock API. We can examine the selected loss function here.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"learn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`loss_func\n`]})})}),(0,e.jsx)(n.p,{children:\"FlattenedLoss of CrossEntropyLoss()\"}),(0,e.jsx)(n.p,{children:\"Let's find a reasonble learning rate.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"lrs \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" learn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"lr_find\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`lrs\n`})]})}),(0,e.jsx)(n.p,{children:\"SuggestedLRs(valley=0.0008317637839354575)\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"png\",src:\"https://www.storminthecastle.com/img/01_classification_files/01_classification_63_3.png\"})}),(0,e.jsxs)(n.h3,{id:\"train-our-model\",children:[(0,e.jsx)(n.a,{href:\"#train-our-model\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Train Our Model\"]}),(0,e.jsx)(n.p,{children:\"We'll fit the model to our training data using the selected loss function. Here we're using fine_tune since we are using the resnet34 pretrained weights.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"learn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"fine_tune\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"base_lr\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"lrs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"valley\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,e.jsxs)(\"table\",{border:\"1\",className:\"dataframe\",children:[(0,e.jsx)(\"thead\",{children:(0,e.jsxs)(\"tr\",{children:[(0,e.jsx)(\"th\",{children:\"epoch\"}),\" \",(0,e.jsx)(\"th\",{children:\"train_loss\"}),\" \",(0,e.jsx)(\"th\",{children:\"valid_loss\"}),\" \",(0,e.jsx)(\"th\",{children:\"accuracy\"}),\" \",(0,e.jsx)(\"th\",{children:\"time\"})]})}),(0,e.jsx)(\"tbody\",{children:(0,e.jsxs)(\"tr\",{children:[(0,e.jsx)(\"td\",{children:\"0\"}),\" \",(0,e.jsx)(\"td\",{children:\"4.157558\"}),\" \",(0,e.jsx)(\"td\",{children:\"1.687271\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.538000\"}),\" \",(0,e.jsx)(\"td\",{children:\"00:05\"})]})})]}),\" \",(0,e.jsxs)(\"table\",{border:\"1\",className:\"dataframe\",children:[(0,e.jsx)(\"thead\",{children:(0,e.jsxs)(\"tr\",{children:[(0,e.jsx)(\"th\",{children:\"epoch\"}),\" \",(0,e.jsx)(\"th\",{children:\"train_loss\"}),\" \",(0,e.jsx)(\"th\",{children:\"valid_loss\"}),\" \",(0,e.jsx)(\"th\",{children:\"accuracy\"}),\" \",(0,e.jsx)(\"th\",{children:\"time\"})]})}),(0,e.jsxs)(\"tbody\",{children:[(0,e.jsxs)(\"tr\",{children:[(0,e.jsx)(\"td\",{children:\"0\"}),\" \",(0,e.jsx)(\"td\",{children:\"2.541830\"}),\" \",(0,e.jsx)(\"td\",{children:\"1.374761\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.622000\"}),\" \",(0,e.jsx)(\"td\",{children:\"00:06\"})]}),(0,e.jsxs)(\"tr\",{children:[(0,e.jsx)(\"td\",{children:\"1\"}),\" \",(0,e.jsx)(\"td\",{children:\"2.298766\"}),\" \",(0,e.jsx)(\"td\",{children:\"1.057605\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.692000\"}),\" \",(0,e.jsx)(\"td\",{children:\"00:06\"})]}),(0,e.jsxs)(\"tr\",{children:[(0,e.jsx)(\"td\",{children:\"2\"}),\" \",(0,e.jsx)(\"td\",{children:\"1.984269\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.888334\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.746000\"}),\" \",(0,e.jsx)(\"td\",{children:\"00:06\"})]}),(0,e.jsxs)(\"tr\",{children:[(0,e.jsx)(\"td\",{children:\"3\"}),\" \",(0,e.jsx)(\"td\",{children:\"1.709419\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.845897\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.780000\"}),\" \",(0,e.jsx)(\"td\",{children:\"00:06\"})]}),(0,e.jsxs)(\"tr\",{children:[(0,e.jsx)(\"td\",{children:\"4\"}),\" \",(0,e.jsx)(\"td\",{children:\"1.484500\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.803179\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.774000\"}),\" \",(0,e.jsx)(\"td\",{children:\"00:06\"})]}),(0,e.jsxs)(\"tr\",{children:[(0,e.jsx)(\"td\",{children:\"5\"}),\" \",(0,e.jsx)(\"td\",{children:\"1.295198\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.795235\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.772000\"}),\" \",(0,e.jsx)(\"td\",{children:\"00:06\"})]}),(0,e.jsxs)(\"tr\",{children:[(0,e.jsx)(\"td\",{children:\"6\"}),\" \",(0,e.jsx)(\"td\",{children:\"1.144498\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.789521\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.786000\"}),\" \",(0,e.jsx)(\"td\",{children:\"00:06\"})]}),(0,e.jsxs)(\"tr\",{children:[(0,e.jsx)(\"td\",{children:\"7\"}),\" \",(0,e.jsx)(\"td\",{children:\"1.041366\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.787113\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.782000\"}),\" \",(0,e.jsx)(\"td\",{children:\"00:06\"})]}),(0,e.jsxs)(\"tr\",{children:[(0,e.jsx)(\"td\",{children:\"8\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.958484\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.785957\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.780000\"}),\" \",(0,e.jsx)(\"td\",{children:\"00:06\"})]}),(0,e.jsxs)(\"tr\",{children:[(0,e.jsx)(\"td\",{children:\"9\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.887360\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.789864\"}),\" \",(0,e.jsx)(\"td\",{children:\"0.780000\"}),\" \",(0,e.jsx)(\"td\",{children:\"00:06\"})]})]})]}),(0,e.jsx)(n.p,{children:\"We're able to get to about 80% accuracy pretty quickly which isn't too bad given that we're trying to predict a single class label to represent the image. Most of the images have multiple objects and the largest objects aren't centered which adds some amount of confusion.\"}),(0,e.jsx)(n.p,{children:\"Let's look at a few predictions showing both the ground-truth label and the label predicted by our trained model.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"learn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"show_results\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"png\",src:\"https://www.storminthecastle.com/img/01_classification_files/01_classification_67_2.png\"})}),(0,e.jsxs)(n.h2,{id:\"summary\",children:[(0,e.jsx)(n.a,{href:\"#summary\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Summary\"]}),(0,e.jsx)(n.p,{children:\"In this article, we started explored the problem of object detection. We selected and explored a dataset that we can use for experimentation and we trained a model to classify the largest object within an image.\"}),(0,e.jsx)(n.p,{children:\"In my next article, I'll start to show how we can climb one more rung up the ladder and walk you through how we can design a model to handle bounding boxes. Building a regression model that can predict the bounding box for the largest object in the image without the class label.\"}),(0,e.jsxs)(n.p,{children:[\"This article series leverages the current version of the \",(0,e.jsx)(n.a,{href:\"https://github.com/fastai/fastai\",children:\"Fast AI 2 library\"}),\" a powerful machine learning framework built on top of PyTorch.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.a,{href:\"https://www.storminthecastle.com/posts/02_bounding_box/\",children:\"Read Part 2\"})})]})}}var w=f;return y;})();\n;return Component;","toc":[{"value":"Exploring the Dataset","url":"#exploring-the-dataset","depth":2},{"value":"Visualize the Dataset","url":"#visualize-the-dataset","depth":2},{"value":"Decomposing the problem","url":"#decomposing-the-problem","depth":2},{"value":"Training a Classification Model","url":"#training-a-classification-model","depth":2},{"value":"Setting up the Dataloaders","url":"#setting-up-the-dataloaders","depth":3},{"value":"Train Our Model","url":"#train-our-model","depth":3},{"value":"Summary","url":"#summary","depth":2}],"frontMatter":{"readingTime":{"text":"16 min read","minutes":15.175,"time":910500,"words":3035},"slug":"01_classification","fileName":"01_classification.md","title":"Object Detection from Scratch - Part 1","date":"2023-01-12T15:32:14.000Z","lastmod":"2023-01-29","tags":["object detection","code"],"draft":false}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.495,"time":29700,"words":99},"slug":["default"],"fileName":"default.md","name":"John Robinson","avatar":"/static/images/avatar.jpeg","occupation":"Software Engineering & Architecture Executive","company":"Consultant for LiquidThought LLC","email":"johnrobinsn@gmail.com","github":"https://github.com/johnrobinsn","twitter":"https://twitter.com/johnrobinsn","linkedin":"https://www.linkedin.com/in/johnrobinsonsprofile/","date":null}],"prev":null,"next":{"title":"Posing Heads with Stable Diffusion","date":"2023-01-29T15:32:14.000Z","lastmod":"2023-01-29","tags":["Diffusion","MID-U","miniai"],"draft":false,"canonicalUrl":"https://tailwind-nextjs-starter-blog.vercel.app/blog/new-features-in-v1/","slug":"posing-heads-with-stable-diffusion"}},"__N_SSG":true}